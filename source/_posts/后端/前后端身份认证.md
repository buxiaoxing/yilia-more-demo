---
title: 前后端身份认证
date: 2022-07-25 14:55:02
tags:
  - 后端
  - jwt
  - cookie
---
**我差一点就碰到月亮了，可惜天却亮了**
<!--more-->


### 身份认证

#### 概述

- 什么是身份认证

  ![image-20220719163124154](http://img.buxiaoxing.com/uPic/2022/07/25145803-U0Av5e-19163126-O0Cn5B-image-20220719163124154.png)

- 为什么需要身份认证

  ![image-20220719163254643](http://img.buxiaoxing.com/uPic/2022/07/19163256-C5x2az-image-20220719163254643.png)

- 不同开发模式下的身份认证

  ![image-20220719163324011](http://img.buxiaoxing.com/uPic/2022/07/19163330-zQcos2-image-20220719163324011.png)

#### session认证机制

- http协议的无状态性

  ![image-20220719163517712](http://img.buxiaoxing.com/uPic/2022/07/19163519-9V4tX5-image-20220719163517712.png)

- 如何突破http无状态的限制

  ![image-20220719163641042](http://img.buxiaoxing.com/uPic/2022/07/19163642-asxBvp-image-20220719163641042.png)

- Cookie

  - 什么是cookie

    ![image-20220719164105483](http://img.buxiaoxing.com/uPic/2022/07/19164106-mprtAf-image-20220719164105483.png)

  - cookie在身份认证中的作用

    ![image-20220719164300591](http://img.buxiaoxing.com/uPic/2022/07/19164302-QqhCs5-image-20220719164300591.png)

  - cookie不具有安全性

    ![image-20220719164633252](http://img.buxiaoxing.com/uPic/2022/07/19164635-HPpBuz-image-20220719164633252.png)

  - 提高身份认证安全性

    ![image-20220719164755788](http://img.buxiaoxing.com/uPic/2022/07/19164757-edIhUV-image-20220719164755788.png)

  - session工作原理

    ![image-20220719165010992](http://img.buxiaoxing.com/uPic/2022/07/19165013-eSs8pt-image-20220719165010992.png)

#### express中使用session认证

- 安装中间件 express-session

  `npm i express-session`

- 配置express-session中间件

  ![image-20220719170253995](http://img.buxiaoxing.com/uPic/2022/07/19170255-UkIfMn-image-20220719170253995.png)

- 向session中存数据

  ![image-20220719170712930](http://img.buxiaoxing.com/uPic/2022/07/19170714-S0y17S-image-20220719170712930.png)

- 从session中取数据

  ![image-20220719171119555](http://img.buxiaoxing.com/uPic/2022/07/19171122-VkrwkN-image-20220719171119555.png)

- 清空session

  ![image-20220719171433524](http://img.buxiaoxing.com/uPic/2022/07/19171435-lpnmtW-image-20220719171433524.png)

#### JWT认证机制

- session认证机制的局限性

  ![image-20220720095006099](http://img.buxiaoxing.com/uPic/2022/07/20095009-NGyerG-image-20220720095006099.png)

- 什么是 JWT

  JWT(Json Web Token)，是目前最流行的跨域认证方案

- JWT工作原理

  ![image-20220720095252498](http://img.buxiaoxing.com/uPic/2022/07/20095258-TW5BEA-image-20220720095252498.png)

- JWT组成部分

  ![image-20220720095426079](http://img.buxiaoxing.com/uPic/2022/07/20095427-75QYiZ-image-20220720095426079.png)

- 三个部分各自的含义

  ![image-20220720095519121](http://img.buxiaoxing.com/uPic/2022/07/20095521-MY1UFp-image-20220720095519121.png)

- JWT使用方式

  ![image-20220720095645939](http://img.buxiaoxing.com/uPic/2022/07/20095647-hg3fot-image-20220720095645939.png)

#### Express中使用JWT

- 安装JWT包

  ![image-20220720095754562](http://img.buxiaoxing.com/uPic/2022/07/20095756-ACsdOz-image-20220720095754562.png)

- 导入包

  ![image-20220720095818427](http://img.buxiaoxing.com/uPic/2022/07/20095820-8jKs71-image-20220720095818427.png)

- 定义secret密钥

  ![image-20220720100201507](http://img.buxiaoxing.com/uPic/2022/07/20100203-6rHFr2-image-20220720100201507.png)

- 登陆成功后生成JWT字符串

  ![image-20220720100342542](http://img.buxiaoxing.com/uPic/2022/07/20100344-krlrDe-image-20220720100342542.png)

- 将 jwt 字符串还原成 json 对象

  ![image-20220720101058352](http://img.buxiaoxing.com/uPic/2022/07/20101059-Bc6DOL-image-20220720101058352.png)

- 使用req.user获取用户信息

  ![image-20220720101814474](http://img.buxiaoxing.com/uPic/2022/07/20101815-ga2p4a-image-20220720101814474.png)

- 捕获解析 JWT 失败后产生的错误

  ![image-20220720103804090](http://img.buxiaoxing.com/uPic/2022/07/20103805-eiIUJs-image-20220720103804090.png)

