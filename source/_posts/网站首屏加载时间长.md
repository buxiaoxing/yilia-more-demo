---
title: 网站首屏加载时间优化
date: 2022-01-06 11:26:45
tags: 
    - 性能
    - 前端
---
- 分析

  1. 使用 `webpack` 的分析工具 `webpack-bundle-analyer`
    <!--more-->
     - 安装

       `npm i webpack-bundle-analyer -D`

     - 配置

       在 `vue.config.js` 增加配置

       ```js
       chainWebpack: config => {
           config
               .plugin("webpack-bundle-analyzer")
               .use(require('webpack-bundle-analyzer').BundleAnalyzerPlugin)
       }
       ```

     - 分析结果

       `npm run build --report`

       ![image-20210121154338389](https://gitee.com/buxiaoxing/image-bed/raw/master/img/image-20210121154338389.png)

  > 由分析图可以看出， mavon-editor.js占了很大的空间（这是一个markdown的在线编辑工具），分析结果根据不同的项目而不同，一般都是 chunk-vendors.js这个文件过大，也就是第三方依赖过大。

- 解决思路

  1. CDN 引入

     > CDN 引入不会将依赖打包到项目中，直接在线引用，所以一般有 CDN 地址的，就用CDN引入

     - index.html

       ![image-20210121154951640](https://gitee.com/buxiaoxing/image-bed/raw/master/img/image-20210121154951640.png)

     - main.js

       对于已经通过 CDN 引入的依赖，不用再引入，router.js 和 store.js 同理

     - vue.config.js 配置别名（项目中直接使用这些别名就行了）

        ![image-20210121155324256](https://gitee.com/buxiaoxing/image-bed/raw/master/img/image-20210121155324256.png)

  2. gzip 压缩

     - `npm i compression-webpack-plugin -D`

     - vue.config.js

       ```js
       plugins: [
           new CompressionPlugin({
               test: /\.js$|\.html$|\.css$|\.jpg$|\.jpeg$|\.png/, // 需要压缩的文件类型
               threshold: 10240, // 归档需要进行压缩的文件大小最小值，我这个是10K以上的进行压缩
               deleteOriginalAssets: false // 是否删除原文件
           })
       ],
       ```

       配置后，执行 `npm run build` 就可以看见 dist 里面多了 gzip 压缩吧

     - nginx 配置 gzip

       ```
       server {
         
           listen 80;
       
           server_name localhost;
       
           #charset koi8-r;
       
           access_log /var/log/nginx/host.access.log main;
       
           error_log /var/log/nginx/error.log error;
       
           gzip on;  
       
           gzip_min_length 1k;
       
           gzip_comp_level 9;
       
           gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httped-php image/jpeg image/gif image/png;
       
           gzip_vary on;
       
           gzip_disable "MSIE [1-6]\.";
       
           location / {
       
               root /usr/share/nginx/html;
       
               index index.html index.htm;
       
               try_files $uri $uri/ /index.html;
       
           }
       
       
       
           #error_page 404 /404.html;
       
       
       
           # redirect server error pages to the static page /50x.html
       
           #
       
           error_page 500 502 503 504 /50x.html;
       
           location = /50x.html {
       
               root /usr/share/nginx/html;
       
           }
         
       }
       
       ```

